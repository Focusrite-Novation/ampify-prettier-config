version: 2.1

jobs:
  publish:
    docker:
      - image: cimg/node:12.18.4
        auth:
          username: ampify
          password: $DOCKER_HUB_PASSWORD
    steps:
      - checkout
      - run: VERSION=1.1.${CIRCLE_BUILD_NUM} npm run bump
      - run: npm publish

workflows:
  publish:
    jobs:
      - publish:
          context:
            - NPM-CONFIG
            - DOCKER_HUB
          filters:
            branches:
              only:
                - master
